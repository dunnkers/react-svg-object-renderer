{"version":3,"sources":["../src/SVGEditableCanvas.js"],"names":["React","Component","PropTypes","HotKeys","HoverRect","SVGEditableCanvas","constructor","props","isHovering","currentlyHovering","selectedObjects","Set","multiSelect","index","setState","event","preventDefault","state","has","size","clear","add","delete","onSelectionChange","Array","from","x","y","width","height","objectRefs","getBBox","multiSelectOn","multiSelectOff","sequence","action","object","objectTypes","ObjectComponent","type","ref","onMouseOver","onMouseDown","onMouseLeave","objectIndex","stroke","fill","strokeWidth","render","objects","selectedObjectsArray","renderHover","map","handlers","window","styles","keyDown","renderObject","renderSelectedObject","number","arrayOf","shape","string","isRequired","objectOf","func","backgroundImage","backgroundSize"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { HotKeys } from 'react-hotkeys';\n\nimport HoverRect from './HoverRect';\n\nexport default class SVGEditableCanvas extends Component {\n  static propTypes = {\n    width: PropTypes.number,\n    height: PropTypes.number,\n    objects: PropTypes.arrayOf(PropTypes.shape({\n      type: PropTypes.string.isRequired\n    })),\n    objectTypes: PropTypes.objectOf(PropTypes.func),\n    onSelectionChange: PropTypes.func\n  }\n\n  static defaultProps = {\n    width: 400,\n    height: 400,\n    objects: [],\n    objectTypes: {},\n    onSelectionChange: () => {}\n  }\n\n  state = {\n    isHovering: false,\n    currentlyHovering: null,\n    selectedObjects: new Set(),\n    multiSelect: false\n  }\n\n  constructor(props) {\n    super(props);\n    this.objectRefs = {};\n  }\n\n  onMouseOver = (index) => this.setState({\n    isHovering: true,\n    currentlyHovering: index\n  });\n\n  onMouseLeave = () => this.setState({ isHovering: false })\n\n  onMouseDown = (index, event) => {\n    event.preventDefault();\n    const { selectedObjects } = this.state;\n\n    if (selectedObjects.has(index)) {\n      if (!this.state.multiSelect && selectedObjects.size > 1) {\n        selectedObjects.clear();\n        selectedObjects.add(index);\n      } else {\n        selectedObjects.delete(index); // de-select\n      }\n    } else {\n      if (!this.state.multiSelect) {\n        selectedObjects.clear();\n      }\n\n      selectedObjects.add(index); // select\n    }\n\n    this.setState({ selectedObjects });\n\n    // notify outside world of selection change. convert set to array.\n    this.props.onSelectionChange(Array.from(selectedObjects));\n  }\n\n  /* âš \n    * getBBox() might have insufficient browser support!\n    * The function has little documentation. In case use of BBox turns out\n    * problematic, consider using `target.getBoundingClientRect()` along with\n    * $('<svg>').getBoundingClientRect() to correct the x and y offset.\n    */\n  getBBox = (index) => {\n    // destruct and construct;  getBBox returns a SVGRect which does not spread.\n    const { x, y, width, height } = this.objectRefs[index].getBBox();\n    return { x, y, width, height };\n  }\n\n  handlers = {\n    multiSelectOn: () => this.setState({ multiSelect: true }),\n    multiSelectOff: () => this.setState({ multiSelect: false })\n  };\n\n  map = {\n    multiSelectOn: { sequence: 'ctrl', action: 'keydown' },\n    multiSelectOff: { sequence: 'ctrl', action: 'keyup' }\n  };\n\n  renderObject = (object, index) => {\n    const { objectTypes } = this.props;\n    const ObjectComponent = objectTypes[object.type];\n\n    return (\n      <ObjectComponent\n        {...object}\n        key={index}\n        refCallback={ref => {\n          this.objectRefs[index] = ref;\n        }} // ðŸ’¡ We should use `createRef` from React ^v16.x onwards instead.\n        onMouseOver={() => this.onMouseOver(index)}\n        onMouseDown={event => this.onMouseDown(index, event)}\n        onMouseLeave={this.onMouseLeave}\n        onFocus={() => { }} // ðŸ”¨ disable eslint rule that requires this\n      />\n    );\n  }\n\n  renderSelectedObject = (objectIndex, index) => {\n    const {\n      x,\n      y,\n      width,\n      height\n    } = this.getBBox(objectIndex);\n\n    return (\n      <rect\n        x={x}\n        y={y}\n        width={width}\n        height={height}\n        style={{\n          stroke: '#4285f4',\n          fill: 'none',\n          strokeWidth: '3px'\n        }}\n        onMouseDown={(event) => this.onMouseDown(objectIndex, event)}\n        key={index}\n      />\n    );\n  }\n\n  render() {\n    const { width, height, objects } = this.props;\n    const { isHovering, currentlyHovering, selectedObjects } = this.state;\n    const selectedObjectsArray = [...selectedObjects]; // Convert Set to Array\n\n    const renderHover = isHovering && \n      !this.state.selectedObjects.has(currentlyHovering);\n\n    return (\n      <HotKeys keyMap={this.map} handlers={this.handlers} focused attach={window}>\n        <svg\n          width={width}\n          height={height}\n          style={styles}\n          onKeyDown={this.keyDown}\n        >\n          {objects.map(this.renderObject)}\n\n          {renderHover && (\n            <HoverRect\n              {...this.getBBox(currentlyHovering)}\n              stopHover={this.onMouseLeave}  \n            />\n          )}\n\n          {selectedObjectsArray.map(this.renderSelectedObject)}\n        </svg>\n      </HotKeys>\n    );\n  }\n}\n\nexport const styles = {\n  backgroundImage: 'url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5'\n    + 'vcmcvMjAwMC9zdmciIHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCI+CjxyZWN0IHdpZHRoPSIyMCIgaGVpZ2h0'\n    + 'PSIyMCIgZmlsbD0iI2ZmZiI+PC9yZWN0Pgo8cmVjdCB3aWR0aD0iMTAiIGhlaWdodD0iMTAiIGZpbGw9I'\n    + 'iNGN0Y3RjciPjwvcmVjdD4KPHJlY3QgeD0iMTAiIHk9IjEwIiB3aWR0aD0iMTAiIGhlaWdodD0iMTAiIG'\n    + 'ZpbGw9IiNGN0Y3RjciPjwvcmVjdD4KPC9zdmc+)',\n  backgroundSize: 'auto'\n};\n"],"file":"SVGEditableCanvas.js"}