{"version":3,"sources":["../src/SVGObjectRenderer.js"],"names":["React","Component","PropTypes","HotKeys","HoverRect","SelectRect","SVGObjectRenderer","constructor","props","isHovering","currentlyHovering","selectedObjects","Set","multiSelect","selectedType","index","setState","event","preventDefault","computeSelection","onSelectionChange","Array","from","state","x","y","width","height","objectRefs","getBBox","multiSelectOn","multiSelectOff","sequence","action","objects","type","multipleTypeSelection","has","size","isSelectedType","object","objectTypes","ObjectComponent","ref","onMouseOver","onMouseDown","onMouseLeave","delete","sameType","add","singleSelect","clear","render","selectedObjectsArray","renderHover","shouldRenderHover","map","handlers","window","styles","renderObject","objectIndex","number","arrayOf","shape","string","isRequired","objectOf","func","bool","backgroundImage","backgroundSize"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { HotKeys } from 'react-hotkeys';\n\nimport HoverRect from './HoverRect';\nimport SelectRect from './SelectRect';\n\nexport default class SVGObjectRenderer extends Component {\n  static propTypes = {\n    width: PropTypes.number,\n    height: PropTypes.number,\n    objects: PropTypes.arrayOf(PropTypes.shape({\n      type: PropTypes.string.isRequired\n    })),\n    objectTypes: PropTypes.objectOf(PropTypes.func),\n    onSelectionChange: PropTypes.func,\n    multipleTypeSelection: PropTypes.bool\n  }\n\n  static defaultProps = {\n    width: 400,\n    height: 400,\n    objects: [],\n    objectTypes: {},\n    onSelectionChange: () => {},\n    multipleTypeSelection: false\n  }\n\n  state = {\n    isHovering: false,\n    currentlyHovering: null,\n    selectedObjects: new Set(),\n    multiSelect: false,\n    selectedType: null\n  }\n\n  constructor(props) {\n    super(props);\n    this.objectRefs = {};\n  }\n\n  onMouseOver = (index) => {\n    this.setState({ isHovering: true, currentlyHovering: index });\n  }\n\n  onMouseLeave = () => this.setState({ isHovering: false })\n\n  onMouseDown = (index, event) => {\n    event.preventDefault(); // ðŸ’¡ Prevents user selecting any svg text\n\n    this.setState({\n      selectedObjects: this.computeSelection(index)\n    });\n\n    // notify outside world of selection change. convert set to array.\n    this.props.onSelectionChange(Array.from(this.state.selectedObjects));\n  }\n\n  /* âš \n    * getBBox() might have insufficient browser support!\n    * The function has little documentation. In case use of BBox turns out\n    * problematic, consider using `target.getBoundingClientRect()` along with\n    * $('<svg>').getBoundingClientRect() to correct the x and y offset.\n    */\n  getBBox = (index) => {\n    // destruct and construct;  getBBox returns a SVGRect which does not spread.\n    const { x, y, width, height } = this.objectRefs[index].getBBox();\n    return { x, y, width, height };\n  }\n\n  handlers = {\n    multiSelectOn: () => this.setState({ multiSelect: true }),\n    multiSelectOff: () => this.setState({ multiSelect: false })\n  };\n\n  map = {\n    multiSelectOn: { sequence: 'ctrl', action: 'keydown' },\n    multiSelectOff: { sequence: 'ctrl', action: 'keyup' }\n  };\n\n  isSelectedType = (index) =>\n    this.props.objects[index].type === this.state.selectedType;\n\n  shouldRenderHover = (index) => {\n    const { isHovering, selectedObjects, multiSelect } = this.state;\n    const { multipleTypeSelection } = this.props;\n\n    // don't render when object already selected\n    if (!isHovering || selectedObjects.has(index)) {\n      return false;\n    }\n    \n    // don't render when selecting objects of same type\n    if (selectedObjects.size > 0 && multiSelect) {\n      return this.isSelectedType(index) || multipleTypeSelection;\n    }\n\n    return true;\n  }\n\n  renderObject = (object, index) => {\n    const { objectTypes } = this.props;\n    const ObjectComponent = objectTypes[object.type];\n\n    return (\n      <ObjectComponent\n        {...object}\n        key={index}\n        refCallback={ref => {\n          this.objectRefs[index] = ref;\n        }} // ðŸ’¡ We should use `createRef` from React ^v16.x onwards instead.\n        onMouseOver={() => this.onMouseOver(index)}\n        onMouseDown={event => this.onMouseDown(index, event)}\n        onMouseLeave={this.onMouseLeave}\n      />\n    );\n  }\n\n  multiSelect(index, objects) {\n    if (objects.has(index)) { // remove from selection\n      objects.delete(index);\n      return objects;\n    } else { // add to selection\n      // possibly, dissalow selecting another type\n      const { multipleTypeSelection } = this.props;\n      const sameType = this.isSelectedType(index) || multipleTypeSelection;\n      return sameType ? objects.add(index) : objects;\n    }\n  }\n\n  singleSelect(index, objects) {\n    if (objects.has(index)) { // deselect\n      objects.clear();\n      return objects;\n    } else { // select\n      objects.clear();\n      this.setState({\n        selectedType: this.props.objects[index].type\n      });\n      return objects.add(index);\n    }\n  }\n\n  computeSelection(index) {\n    const { selectedObjects, multiSelect } = this.state;\n\n    if (multiSelect && selectedObjects.size > 0) {\n      return this.multiSelect(index, selectedObjects);\n    } else {\n      return this.singleSelect(index, selectedObjects);\n    }\n  }\n\n  render() {\n    const { width, height, objects } = this.props;\n    const { currentlyHovering, selectedObjects } = this.state;\n    const selectedObjectsArray = [...selectedObjects]; // Convert Set to Array\n    const renderHover = this.shouldRenderHover(currentlyHovering);\n\n    return (\n      <HotKeys keyMap={this.map} handlers={this.handlers} focused attach={window}>\n        <svg width={width} height={height} style={styles} >\n          {objects.map(this.renderObject)}\n\n          {renderHover && (\n            <HoverRect\n              {...this.getBBox(currentlyHovering)}\n              stopHover={this.onMouseLeave}  \n            />\n          )}\n\n          {selectedObjectsArray.map((objectIndex, index) => (\n            <SelectRect\n              {...this.getBBox(objectIndex)}\n              key={index}\n              select={(event) => this.onMouseDown(objectIndex, event)}\n            />\n          ))}\n        </svg>\n      </HotKeys>\n    );\n  }\n}\n\nexport const styles = {\n  backgroundImage: 'url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5'\n    + 'vcmcvMjAwMC9zdmciIHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCI+CjxyZWN0IHdpZHRoPSIyMCIgaGVpZ2h0'\n    + 'PSIyMCIgZmlsbD0iI2ZmZiI+PC9yZWN0Pgo8cmVjdCB3aWR0aD0iMTAiIGhlaWdodD0iMTAiIGZpbGw9I'\n    + 'iNGN0Y3RjciPjwvcmVjdD4KPHJlY3QgeD0iMTAiIHk9IjEwIiB3aWR0aD0iMTAiIGhlaWdodD0iMTAiIG'\n    + 'ZpbGw9IiNGN0Y3RjciPjwvcmVjdD4KPC9zdmc+)',\n  backgroundSize: 'auto'\n};\n"],"file":"SVGObjectRenderer.js"}